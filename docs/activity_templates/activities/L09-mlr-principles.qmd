# Multiple regression principles


<!-- NOTES to instructor: -->
<!-- - I recommend doing the first 3 exercises as a class. They're a review of the previous class. -->



```{r include = FALSE, message = FALSE, warning = FALSE}
knitr::opts_chunk$set(
  collapse = TRUE, 
  warning = FALSE,
  message = FALSE,
  error = TRUE)
```


<!-- create student notes from activity in core-->

{{< include _create_student_notes.qmd >}}

```{r}
#| echo: false
#| eval: true
make_student_notes('Multiple regression principles', '_L09-mlr-principles.qmd')
```

<!-- pull activity from core -->

```{r knitr-opts}
#| echo: false
#| cache: false
knitr::opts_chunk$set(eval = FALSE, echo = TRUE)
```

{{< include core/_L09-mlr-principles.qmd >}}




\
\
\
\



# Solutions

```{r eval = TRUE, echo = FALSE}
# Load packages & import data
library(readr)
library(ggplot2)
library(dplyr)

bikes <- read_csv("https://mac-stat.github.io/data/bikeshare.csv") %>% 
  rename(rides = riders_registered)
```


## Exercise 1: Review visualization

```{r eval = TRUE}
bikes %>% 
  ggplot(aes(y = rides, x = windspeed, color = weekend)) + 
  geom_point() + 
  geom_smooth(method = "lm", se = FALSE)
```


## Exercise 2: Review model

weekdays: rides = 4738.38 - 63.97 windspeed    

weekends: rides = 4738.38 - 63.97 windspeed - 925.16 = 3813.22 - 63.97 windspeed


## Exercise 3: Review coefficient interpretation

a. We expect an average of 4738 riders on **weekdays with 0 windspeed**.

b. On average, we expect a 1mph increase in windspeed to be associated with 64 fewer riders, controlling for weekend status.

c. On average, we expect 925 fewer riders on weekend days than on weekends, controlling for windspeed.




## Exercise 4: 2 categorical predictors – visualization


```{r eval = TRUE}
bikes %>% 
  ggplot(aes(y = rides, x = season, fill = weekend)) + 
  geom_boxplot()
```




## Exercise 5: follow-up

a. In every season, ridership tends to be lower on weekends. Across weekend status, ridership tends to be highest in summer and lowest in winter.

b. 8 expected outcomes



## Exercise 6: 2 categorical predictors – build the model

a.

```{r eval = TRUE}
#fall weekday:    
4260.45 - 912.33*0 - 116.38*0 + 438.44*0 - 1719.06*0

#winter weekday:
4260.45 - 912.33*0 - 116.38*0 + 438.44*0 - 1719.06*1

#fall weekend:    
4260.45 - 912.33*1 - 116.38*0 + 438.44*0 - 1719.06*0

#winter weekend:
4260.45 - 912.33*1 - 116.38*0 + 438.44*0 - 1719.06*1
```

b. 8: 2 weekend categories * 4 season categories    


## Exercise 7: 2 categorical predictors – interpret the model


a. We expect there to be, on average, 4260 riders on **weekdays** during the **fall**.
b. On average, we expect there to be 912 fewer riders on weekends than on weekends, adjusting for season.
c. On average, we expect there to be 1719 fewer riders in winter than in fall, adjusting for weekday status.


## Exercise 8: 2 quantitative predictors – visualization


```{r eval = TRUE}
bikes %>% 
  ggplot(aes(y = rides, x = windspeed, color = temp_feel)) + 
  geom_point() 
```




## Exercise 9: follow-up

Ridership tends to increase with temperature (no matter the windspeed) and decrease with windspeed (no matter the temperature).



## Exercise 10: 2 quantitative predictors – modeling

a. -24.06 = average ridership on days with 0 windspeed and a 0 degree temperature. (Note: this is a *correct* interpretation, even though it doesn't make conceptual sense! The model doesn't know that ridership can't be negative!)

b. On average, we expect a 1mph increase in windspeed to be associated with 37 fewer riders on a given day, adjusting for temperature.

c. On average, we expect a 1 degree increase in temperature to be associated with 56 more riders on a given day, adjusting for windspeed.


## Exercise 11: Which is best?

a. model 2
b. temperature
c. R-squared increases (our model is stronger when we include another predictor)
d. nope. model 1 (with windspeed and weekend) has a lower R-squared than model 5 (with only temperature)
    

\
\


## Exercise 13: Practice 1    

```{r eval = TRUE}
bikes %>% 
  ggplot(aes(y = rides, x = weekend, fill = weather_cat)) + 
  geom_boxplot()

new_model_1 <- lm(rides ~ weekend + weather_cat, bikes)
coef(summary(new_model_1))
```



- The average ridership on a *weekday* with *nice* weather (categ1) is 4212 rides.    

- On days with the same weather, we expect on average 982 rides less on a weekend than on a weekday.

- On average, we expect ridership to be 609 rides less on dreary days than when the weather is nice, controlling for day of the week.


\
\




## Exercise 14: Practice 2    
    
```{r eval = TRUE}
bikes %>% 
  ggplot(aes(y = rides, x = temp_feel, color = humidity)) + 
    geom_point()

new_model_2 <- lm(rides ~ temp_feel + humidity, bikes)
coef(summary(new_model_2))
```

- On average, we expect 316 riders on days that feel like 0 degrees with no humidity.

- On average, we expect a 1 degree increase in ridership to be associated with a 60 ride increase in ridership, for days with the same humidity.

- On average, we expect a 0.1 increase in humidity levels to be associated with a decrease in ridership by 187 rides, for days with the same temperature.


\
\




## Exercise 15: Practice 3

```{r eval = TRUE}
new_model_3 <- lm(rides ~ temp_feel + weather_cat, bikes)
coef(summary(new_model_3))

bikes %>% 
  ggplot(aes(y = rides, x = temp_feel, color = weather_cat)) + 
  geom_point() + 
  geom_line(aes(y = new_model_3$fitted.values), size = 1.5)
```
- We expect an average of -289 riders on nice weather days that feel like 0 degrees. (Note: this is a *correct* interpretation, even though it doesn't make conceptual sense!)

- On average, we expect a 1 degree increase in temperature to be associated with a 55 ride increase, for days with the same weather.

- On average, we expect the number of rides to be 386 rides lower on a dreary weather day compared to a nice weather day, for days with the same temperature.

## Exercise 16: CHALLENGE

   
```{r eval = TRUE}
bikes %>% 
  ggplot(aes(y = rides, x = temp_feel, color = humidity, size = weekend)) + 
  geom_point()

new_model_4 <- lm(rides ~ temp_feel + humidity + weekend, bikes)
coef(summary(new_model_4))
```

- We expect an average of 669 riders on weekdays that feel like 0 degrees, and have no humidity.

- On average, we expect a 1 degree increase in temperature to be associated with a 59 ride increase in ridership, for days with the same humidity levels and time of the week.

- On average, we expect a 0.1 point increase in humidity levels to be associated with a 190.6 ride decrease in ridership, for days with the same temperature and time of the week.

- On average, we expect ridership to be 869 rides lower on weekends compared to weekdays, controlling for temperature and humidity.






